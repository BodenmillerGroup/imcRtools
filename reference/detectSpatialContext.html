<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Detect the spatial context of each cell based on its neighborhood — detectSpatialContext • imcRtools</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Detect the spatial context of each cell based on its neighborhood — detectSpatialContext"><meta property="og:description" content="Function to detect the spatial context (SC) of each cell. 
Based on its sorted (high-to-low) cellular neighborhood (CN) fractions in a 
spatial interaction graph, the SC of each cell is assigned as the set of CNs 
that cumulatively exceed a user-defined fraction threshold.
The term was coined by 
Bhate S. et al., Tissue schematics map the specialization of immune tissue 
motifs and their appropriation by tumors, Cell Systems, 2022 and describes 
tissue regions in which distinct CNs may be interacting."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">imcRtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/imcRtools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BodenmillerGroup/imcRtools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Detect the spatial context of each cell based on its neighborhood</h1>
    <small class="dont-index">Source: <a href="https://github.com/BodenmillerGroup/imcRtools/blob/HEAD/R/detectSpatialContext.R" class="external-link"><code>R/detectSpatialContext.R</code></a></small>
    <div class="hidden name"><code>detectSpatialContext.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function to detect the spatial context (SC) of each cell. 
Based on its sorted (high-to-low) cellular neighborhood (CN) fractions in a 
spatial interaction graph, the SC of each cell is assigned as the set of CNs 
that cumulatively exceed a user-defined fraction threshold.</p>
<p>The term was coined by <a href="https://doi.org/10.1016/j.cels.2021.09.012" class="external-link">
Bhate S. et al., Tissue schematics map the specialization of immune tissue 
motifs and their appropriation by tumors, Cell Systems, 2022</a> and describes 
tissue regions in which distinct CNs may be interacting.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">detectSpatialContext</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  entry <span class="op">=</span> <span class="st">"aggregatedNeighbors"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"spatial_context"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>a <code>SingleCellExperiment</code> or <code>SpatialExperiment</code>
object</p></dd>


<dt>entry</dt>
<dd><p>single character specifying the <code>colData(object)</code>
entry containing the <code>aggregateNeighbors</code> DataFrame output. 
Defaults to "aggregatedNeighbors".</p></dd>


<dt>threshold</dt>
<dd><p>single numeric between 0 and 1 that specifies the fraction 
threshold for SC assignment. Defaults to 0.9.</p></dd>


<dt>name</dt>
<dd><p>single character specifying the name of the output saved in 
<code>colData(object)</code>. Defaults to "spatial_context".</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>returns an object of <code>class(object)</code> containing a new column 
entry to <code>colData(object)[[name]]</code></p>


    </div>
    <div id="spatial-context-background">
    <h2>Spatial context background</h2>
    

<p>The function relies on CN fractions for each cell in a 
spatial interaction graph (originally a k-nearest neighbor (KNN) graph).</p>
<p>We can retrieve the CN fractions using the <a href="buildSpatialGraph.html">buildSpatialGraph</a> 
and <a href="aggregateNeighbors.html">aggregateNeighbors</a> functions.</p>
<p>The window size (k for KNN) for <a href="buildSpatialGraph.html">buildSpatialGraph</a> should 
reflect a length scale on which biological signals can be exchanged and 
depends, among others, on cell density and tissue area. In view of their 
divergent functionality, we recommend to use a larger window size for SC 
(interaction between local processes) than for CN (local processes) detection.</p>
<p>Subsequently, the CN fractions are sorted from high-to-low and the SC of
each cell is assigned the minimal combination of SCs that additively
surpass a user-defined threshold. The default threshold of 0.9 aims to
represent the dominant CNs, hence the most prevalent signals, in a given window.</p>
<p>For more details, please refer to:
<a href="https://doi.org/10.1016/j.cels.2021.09.012" class="external-link"> Bhate S. et al., Tissue
schematics map the specialization of immune tissue motifs and their
appropriation by tumors, Cell Systems, 2022</a>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p><a href="https://doi.org/10.1016/j.cels.2021.09.012" class="external-link">
Bhate S. et al., Tissue schematics map the specialization of immune tissue 
motifs and their appropriation by tumors, Cell Systems, 2022</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="filterSpatialContext.html">filterSpatialContext</a></code> for the function to filter 
spatial contexts</p>
<p><code><a href="plotSpatialContext.html">plotSpatialContext</a></code> for the function to plot 
spatial context graphs</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Lasse Meyer (<a href="mailto:lasse.meyer@uzh.ch">lasse.meyer@uzh.ch</a>)</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">22</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BodenmillerGroup/cytomapper" class="external-link">cytomapper</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pancreasSCE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## 1. Cellular neighborhood (CN)</span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="buildSpatialGraph.html">buildSpatialGraph</a></span><span class="op">(</span><span class="va">pancreasSCE</span>, img_id <span class="op">=</span> <span class="st">"ImageNb"</span>,</span></span>
<span class="r-in"><span>                        type <span class="op">=</span> <span class="st">"knn"</span>,</span></span>
<span class="r-in"><span>                        name <span class="op">=</span> <span class="st">"knn_cn_graph"</span>,</span></span>
<span class="r-in"><span>                        k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="aggregateNeighbors.html">aggregateNeighbors</a></span><span class="op">(</span><span class="va">sce</span>, colPairName <span class="op">=</span> <span class="st">"knn_cn_graph"</span>,</span></span>
<span class="r-in"><span>                         aggregate_by <span class="op">=</span> <span class="st">"metadata"</span>,</span></span>
<span class="r-in"><span>                         count_by <span class="op">=</span> <span class="st">"CellType"</span>,</span></span>
<span class="r-in"><span>                         name <span class="op">=</span> <span class="st">"aggregatedCellTypes"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cur_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">sce</span><span class="op">$</span><span class="va">aggregatedCellTypes</span>, centers <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sce</span><span class="op">$</span><span class="va">cellular_neighborhood</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cur_cluster</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotSpatial.html">plotSpatial</a></span><span class="op">(</span><span class="va">sce</span>, img_id <span class="op">=</span> <span class="st">"ImageNb"</span>,</span></span>
<span class="r-in"><span>           colPairName <span class="op">=</span> <span class="st">"knn_cn_graph"</span>,</span></span>
<span class="r-in"><span>           node_color_by <span class="op">=</span> <span class="st">"cellular_neighborhood"</span>,</span></span>
<span class="r-in"><span>           scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="detectSpatialContext-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## 2. Spatial context (SC)</span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="buildSpatialGraph.html">buildSpatialGraph</a></span><span class="op">(</span><span class="va">sce</span>, img_id <span class="op">=</span> <span class="st">"ImageNb"</span>,</span></span>
<span class="r-in"><span>                        type <span class="op">=</span> <span class="st">"knn"</span>,</span></span>
<span class="r-in"><span>                        name <span class="op">=</span> <span class="st">"knn_sc_graph"</span>,</span></span>
<span class="r-in"><span>                        k <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="aggregateNeighbors.html">aggregateNeighbors</a></span><span class="op">(</span><span class="va">sce</span>, colPairName <span class="op">=</span> <span class="st">"knn_sc_graph"</span>,</span></span>
<span class="r-in"><span>                         aggregate_by <span class="op">=</span> <span class="st">"metadata"</span>,</span></span>
<span class="r-in"><span>                         count_by <span class="op">=</span> <span class="st">"cellular_neighborhood"</span>,</span></span>
<span class="r-in"><span>                         name <span class="op">=</span> <span class="st">"aggregatedNeighborhood"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Detect spatial context</span></span></span>
<span class="r-in"><span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">detectSpatialContext</span><span class="op">(</span><span class="va">sce</span>, entry <span class="op">=</span> <span class="st">"aggregatedNeighborhood"</span>,</span></span>
<span class="r-in"><span>                           threshold <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotSpatial.html">plotSpatial</a></span><span class="op">(</span><span class="va">sce</span>, img_id <span class="op">=</span> <span class="st">"ImageNb"</span>,</span></span>
<span class="r-in"><span>           colPairName <span class="op">=</span> <span class="st">"knn_sc_graph"</span>,</span></span>
<span class="r-in"><span>           node_color_by <span class="op">=</span> <span class="st">"spatial_context"</span>,</span></span>
<span class="r-in"><span>           scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="detectSpatialContext-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span>           </span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nils Eling.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

